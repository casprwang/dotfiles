{"version":3,"file":"command.js","sourceRoot":"","sources":["command.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\n\nimport Option from \"./option\";\nimport Argument from \"./argument\";\n\nimport * as utils from \"./utils\";\n\n// jsdoc, see constructor.\nexport default class Command<Opt, Arg> {\n    /**\n     * @private\n     */\n    _description: string;\n    /**\n     * @private\n     */\n    _usage: string;\n    /**\n     * @private\n     */\n    _help = new Option(\"-h, --help\", \"display help\");\n    /**\n     * @private\n     */\n    _version: Option;\n    /**\n     * @private\n     */\n    _versionStr: string;\n    /**\n     * @private\n     */\n    _action: (opts: Opt, args: Arg, rest: string[]) => any;\n\n    /**\n     * e.g. -abc --foo bar\n     * @private\n     */\n    _rawArgs: string[];\n    /**\n     * e.g. -a -b -c --foo bar\n     * @private\n     */\n    _args: string[];\n    /**\n     * e.g. bar\n     * @private\n     */\n    _rest: string[] = [];\n\n    /**\n     * @private\n     */\n    _allowUnknownOption: boolean;\n\n    /**\n     * parent command.\n     */\n    parent: Command<any, any>;\n    /**\n     * name of this command.\n     */\n    name: string;\n\n    /**\n     * e.g.\n     * ```\n     *   git -p clone git@github.com:vvakame/dtsm.git\n     *       ↑ this!\n     * ```\n     * @type {Array}\n     */\n    options: Option[] = [];\n    /**\n     * e.g.\n     * ```\n     *   git -p clone git@github.com:vvakame/dtsm.git\n     *          ↑ this!\n     * ```\n     * @type {Array}\n     */\n    subCommands: Command<any, any>[] = [];\n    /**\n     * e.g.\n     * ```\n     *   git -p clone git@github.com:vvakame/dtsm.git\n     *                ↑ this!\n     * ```\n     * @type {Array}\n     */\n    args: Argument[];\n\n    /**\n     * parsed option values.\n     * @type {any}\n     */\n    parsedOpts: Opt = <any>{};\n    /**\n     * parsed option arguments.\n     * @type {any}\n     */\n    parsedArgs: Arg = <any>{};\n\n    /**\n     * unknown options.\n     * @type {Array}\n     */\n    unknownOptions: string[] = [];\n\n    /**\n     * class of command.\n     * ```\n     * cmd -v sub --path foo/bar buzz.txt\n     *        ↑ this one!\n     * ```\n     * @param name name and flags pass flags pass 'foo'(sub command) or 'foo <bar>'(sub command & required argument) or 'foo [bar]'(sub command & optional argument) or 'foo <bar...>'(sub command & required variadic argument) or 'foo [bar...]'(sub command & optional variadic argument).\n     * @class\n     */\n    constructor(name: string) {\n        let args = name.split(/\\s+/);\n        this.name = args.shift();\n\n        let findOptional = false;\n        let findVariadic = false;\n        this.args = args.map(argStr => {\n            if (findVariadic) {\n                throw new Error(\"parameter can not placed after variadic parameter\");\n            }\n            let arg = new Argument(argStr);\n            if (arg.required && findOptional) {\n                throw new Error(\"required parameter is not placed after optional parameter\");\n            }\n            if (!arg.required) {\n                findOptional = true;\n            }\n            if (arg.variadic) {\n                findVariadic = true;\n            }\n            return arg;\n        });\n\n        this._action = () => {\n            process.stdout.write(this.helpText() + \"\\n\");\n        };\n    }\n\n    /**\n     * set description for this command.\n     * @param desc\n     * @returns {Command}\n     * @method\n     */\n    description(desc: string): Command<Opt, Arg> {\n        this._description = desc;\n        return this;\n    }\n\n    /**\n     * set usage for this command.\n     * @param usage\n     * @returns {Command}\n     * @method\n     */\n    usage(usage: string): Command<Opt, Arg> {\n        this._usage = usage;\n        return this;\n    }\n\n    /**\n     * add option for this command.\n     * see {@link Option}.\n     * @param flags\n     * @param description\n     * @param defaultValue\n     * @returns {Command}\n     */\n    option(flags: string, description?: string, defaultValue?: any): Command<Opt, Arg> {\n        let option = new Option(flags, description, defaultValue);\n        this.options.push(option);\n        return this;\n    }\n\n    /**\n     * allow unknown option.\n     * by default, An error occured if unknown option is included.\n     * @param flag\n     * @returns {Command}\n     */\n    allowUnknownOption(flag = true): Command<Opt, Arg> {\n        this._allowUnknownOption = flag;\n        return this;\n    }\n\n    /**\n     * add action at this command selected.\n     * @param fn\n     * @returns {Command}\n     */\n    action(fn: (opts: Opt, args: Arg, rest: string[]) => any): Command<Opt, Arg> {\n        this._action = fn;\n        return this;\n    }\n\n    /**\n     * create sub command.\n     * @param name\n     * @returns {Command<Opt2, Arg2>} new command instance\n     */\n    subCommand<Opt2, Arg2>(name: string): Command<Opt2, Arg2> {\n        let command = new Command<Opt2, Arg2>(name);\n        command.parent = this;\n        this.subCommands.push(command);\n        return command;\n    }\n\n    /**\n     * check arg is matches this command.\n     * @param arg\n     * @returns {boolean}\n     */\n    is(arg: string) {\n        return this.name === arg;\n    }\n\n    /**\n     * add help this option.\n     * in general case, use default help option.\n     * @param flags\n     * @param description\n     * @returns {Command}\n     */\n    help(flags: string, description: string) {\n        this._help = new Option(flags, description);\n        return this;\n    }\n\n    /**\n     * add show version option to this command.\n     * @param version\n     * @param flags\n     * @param description\n     * @returns {Command}\n     */\n    version(version: string, flags: string, description: string = \"output the version number\"): Command<Opt, Arg> {\n        this._version = new Option(flags, description);\n        this._versionStr = version;\n        return this;\n    }\n\n    /**\n     * exec action of command.\n     * this method MUST call after parse process.\n     * @returns {Promise<{}>}\n     */\n    exec(): Promise<{}> {\n        return Promise.resolve(this._action(this.parsedOpts, this.parsedArgs, this._rest));\n    }\n\n    /**\n     * parse argv.\n     * @param argv\n     * @returns {Promise<{}>}\n     */\n    parse(argv: string[]): Promise<{}> {\n        return Promise\n            .resolve(null)\n            .then(() => {\n                let rest = this._parseRawArgs(argv);\n                // resolve help action\n                if (this._args.some(arg => this._help.is(arg))) {\n                    // include help option. (help for this command\n                    process.stdout.write(this.helpText() + \"\\n\");\n                    process.exit(0);\n\n                    return Promise.resolve({});\n                }\n                let subCommand: Command<any, any>;\n                if (this.parent == null) {\n                    // only for top level (why? because I can't decide which is natural syntax between `foo help bar buzz` and `foo bar help buzz`.\n                    if (this._rest.some(arg => this._help.name() === arg)) {\n                        // include help sub command. (help for deeper level sub command\n                        if (rest[0]) {\n                            subCommand = this.subCommands.filter(cmd => cmd.is(rest[0]))[0];\n                            if (subCommand) {\n                                process.stdout.write(subCommand.helpText() + \"\\n\");\n                                process.exit(0);\n\n                                return Promise.resolve({});\n                            }\n                        }\n                        // TODO raise error? pass through?\n                    }\n                }\n                // resolve version option\n                if (this._version && this._args.some(arg => this._version.is(arg))) {\n                    process.stdout.write((this._versionStr || \"unknown\") + \"\\n\");\n                    process.exit(0);\n\n                    return Promise.resolve({});\n                }\n\n                if (rest[0]) {\n                    subCommand = this.subCommands.filter(cmd => cmd.is(rest[0]))[0];\n                    if (subCommand) {\n                        return subCommand.parse(rest.slice(1));\n                    }\n                }\n                return this.exec();\n            });\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _getAncestorsAndMe(): Command<any, any>[] {\n        if (!this.parent) {\n            return [this];\n        } else {\n            return this.parent._getAncestorsAndMe().concat([this]);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {string[]}\n     * @private\n     */\n    _parseRawArgs(args: string[]) {\n        args = args.slice(0);\n        let target: string[] = [];\n        let rest: string[] = [];\n\n        for (let i = 0; i < args.length; i++) {\n            let arg = args[i];\n            if (arg === \"--\") {\n                // Honor option terminator\n                target = target.concat(args.slice(i));\n                break;\n            }\n            let cmd = this.subCommands.filter(cmd => cmd.is(arg))[0];\n            if (cmd) {\n                rest = args.slice(i);\n                break;\n            }\n            target.push(arg);\n        }\n\n        this._rawArgs = target.slice(0);\n        this._args = this._normalize(target);\n        this._rest = this._parseOptions(this._args);\n        let cmds = this._getAncestorsAndMe();\n        let allowUnknownOption = cmds.reverse().map(cmd => cmd._allowUnknownOption).filter(allowUnknownOption => typeof allowUnknownOption !== \"undefined\")[0];\n        if (this.unknownOptions.length !== 0 && !allowUnknownOption) {\n            let errMsg = \"unknown option\";\n            errMsg += this.unknownOptions.length === 1 ? \" \" : \"s \";\n            errMsg += this.unknownOptions.join(\", \") + \"\\n\";\n            errMsg += this.helpText();\n            throw new Error(errMsg);\n        }\n        if (this._matchSubCommand(rest)) {\n            return rest;\n        }\n        this._rest = this._parseArgs(this._rest);\n\n        return rest;\n    }\n\n    /**\n     * @param rest\n     * @returns {boolean}\n     * @private\n     */\n    _matchSubCommand(rest: string[]): boolean {\n        if (rest == null || !rest[0]) {\n            return false;\n        }\n        let subCommand = this.subCommands.filter(cmd => cmd.is(rest[0]))[0];\n        return !!subCommand;\n    }\n\n    /**\n     * @param args\n     * @returns {string[]}\n     * @private\n     */\n    _parseOptions(args: string[]) {\n        args = args.slice(0);\n        let rest: string[] = [];\n        let processedOptions: Option[] = [];\n        while (args.length !== 0) {\n            let arg = args.shift();\n            if (arg === \"--\") {\n                rest = rest.concat(args);\n                break;\n            }\n            let opt = this.options.filter(opt => opt.is(arg))[0];\n            if (!opt) {\n                rest.push(arg);\n                if (arg.indexOf(\"-\") === 0 && !this._help.is(arg) && (!this._version || !this._version.is(arg))) {\n                    this.unknownOptions.push(arg);\n                }\n                continue;\n            }\n            args = opt.parse(this.parsedOpts, [arg].concat(args));\n            processedOptions.push(opt);\n        }\n        this.options\n            .filter(opt => processedOptions.indexOf(opt) === -1)\n            .forEach(opt => {\n                if (opt.required || opt.optional) {\n                    // string[]\n                    (<any>this.parsedOpts)[opt.name()] = (<any>this.parsedOpts)[opt.name()] || [];\n                    if (opt.defaultValue) {\n                        (<any>this.parsedOpts)[opt.name()].push(opt.defaultValue);\n                    }\n                } else {\n                    (<any>this.parsedOpts)[opt.name()] = opt.defaultValue;\n                }\n            });\n        return rest;\n    }\n\n    /**\n     * @param rest\n     * @returns {string[]}\n     * @private\n     */\n    _parseArgs(rest: string[]) {\n        rest = rest.slice(0);\n        this.args.forEach(argInfo => {\n            rest = argInfo.parse(this.parsedArgs, rest);\n        });\n        return rest;\n    }\n\n    /**\n     * @param args\n     * @returns {string[]}\n     * @private\n     */\n    _normalize(args: string[]): string[] {\n        let result: string[] = [];\n        for (let i = 0; i < args.length; i++) {\n            let arg = args[i];\n            let lastOpt: Option;\n            if (0 < i) {\n                lastOpt = this.options.filter(opt => opt.is(args[i - 1]))[0];\n            }\n            if (arg === \"--\") {\n                // Honor option terminator\n                result = result.concat(args.slice(i));\n                break;\n            } else if (lastOpt && lastOpt.required) {\n                result.push(arg);\n            } else if (/^-[^-]/.test(arg)) {\n                // expand combined short hand option. \"-abc\" to \"-a -b -c\"\n                arg.slice(1).split(\"\").forEach(c => result.push(\"-\" + c));\n            } else if (/^--/.test(arg) && arg.indexOf(\"=\") !== -1) {\n                result.push(arg.slice(0, arg.indexOf(\"=\")), arg.slice(arg.indexOf(\"=\") + 1));\n            } else {\n                result.push(arg);\n            }\n        }\n        return result;\n    }\n\n    /**\n     * generate help text.\n     * @returns {string}\n     */\n    helpText(): string {\n        let result = \"\";\n        // usage part\n        result += \"  Usage: \";\n        if (this._usage != null) {\n            result += this._usage;\n        } else {\n            result += this._getAncestorsAndMe().map(cmd => cmd.name).join(\" \") + \" \";\n            if (this.options.length !== 0) {\n                result += \"[options] \";\n            }\n            if (this.subCommands.length !== 0) {\n                result += \"[command] \";\n            }\n            if (this.args.length !== 0) {\n                result += \"[--] \";\n                result += this.args.map(arg => {\n                    if (arg.required) {\n                        return \"<\" + arg.name + (arg.variadic ? \"...\" : \"\") + \">\";\n                    } else {\n                        return \"[\" + arg.name + (arg.variadic ? \"...\" : \"\") + \"]\";\n                    }\n                }).join(\" \");\n            }\n        }\n        result += \"\\n\\n\";\n\n        // options part\n        if (this.options.length !== 0) {\n            result += \"  Options:\\n\\n\";\n            let optionsMaxLength = utils.maxLength(this.options.map(opt => opt.flags));\n            result += this.options.map(opt => {\n                let result = \"    \";\n                result += utils.pad(opt.flags, optionsMaxLength);\n                result += \"  \";\n                result += opt.description || \"\";\n                result += \"\\n\";\n                return result;\n            }).join(\"\");\n            result += \"\\n\\n\";\n        }\n\n        // sub commands part\n        if (this.subCommands.length !== 0) {\n            result += \"  Commands:\\n\\n\";\n            let subCommandsMaxLength = utils.maxLength(this.subCommands.map(cmd => cmd.name));\n            result += this.subCommands.map(cmd => {\n                let result = \"    \";\n                result += utils.pad(cmd.name, subCommandsMaxLength);\n                result += \"  \";\n                result += cmd._description || \"\";\n                result += \"\\n\";\n                return result;\n            }).join(\"\");\n            result += \"\\n\\n\";\n        }\n\n        return result;\n    }\n}\n"]}